<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Your Registration</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                radial-gradient(circle at 20% 50%, rgba(147, 197, 253, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(196, 181, 253, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .container {
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 16px;
            box-shadow:
                0 20px 60px rgba(0, 0, 0, 0.3),
                0 0 0 1px rgba(255, 255, 255, 0.1) inset;
            max-width: 460px;
            width: 100%;
            padding: 56px 48px;
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            margin-bottom: 48px;
        }

        .logo {
            width: 100px;
            height: 100px;
            margin: 0 auto 32px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow:
                0 8px 24px rgba(0, 0, 0, 0.15),
                0 0 0 1px rgba(0, 0, 0, 0.05);
        }

        .logo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        h1 {
            color: #0f172a;
            margin-bottom: 12px;
            font-size: 26px;
            font-weight: 600;
            letter-spacing: -0.5px;
        }

        .subtitle {
            color: #64748b;
            font-size: 15px;
            font-weight: 400;
        }

        .form-group {
            margin-bottom: 24px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #1e293b;
            font-weight: 500;
            font-size: 14px;
            letter-spacing: 0.2px;
        }

        .input-wrapper {
            position: relative;
        }

        input {
            width: 100%;
            padding: 14px 16px;
            border: 1.5px solid #e2e8f0;
            border-radius: 10px;
            font-size: 15px;
            transition: all 0.3s ease;
            background: #ffffff;
            color: #0f172a;
        }

        input:focus {
            outline: none;
            border-color: #94a3b8;
            background: #ffffff;
            box-shadow: 0 0 0 4px rgba(148, 163, 184, 0.1);
        }

        input::placeholder {
            color: #cbd5e1;
        }

        .password-toggle {
            position: absolute;
            right: 14px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #94a3b8;
            cursor: pointer;
            padding: 6px;
            transition: color 0.2s;
        }

        .password-toggle:hover {
            color: #64748b;
        }

        .password-warning {
            margin-top: 10px;
            padding: 12px 14px;
            border-radius: 8px;
            font-size: 13px;
            line-height: 1.5;
            display: flex;
            align-items: flex-start;
            gap: 10px;
            background: rgba(254, 243, 199, 0.95);
            color: #92400e;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        .password-warning svg {
            flex-shrink: 0;
            margin-top: 1px;
        }

        .btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            color: #ffffff;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 16px;
            letter-spacing: 0.3px;
            box-shadow: 0 4px 16px rgba(15, 23, 42, 0.2);
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(15, 23, 42, 0.3);
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        }

        .btn:active:not(:disabled) {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            background: linear-gradient(135deg, #94a3b8 0%, #cbd5e1 100%);
        }

        .alert {
            padding: 14px 18px;
            border-radius: 10px;
            margin-bottom: 24px;
            font-size: 14px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            backdrop-filter: blur(10px);
        }

        .alert svg {
            flex-shrink: 0;
            margin-top: 1px;
        }

        .error {
            background: rgba(254, 242, 242, 0.95);
            color: #991b1b;
            border: 1px solid rgba(254, 202, 202, 0.5);
        }

        .success {
            background: rgba(240, 253, 244, 0.95);
            color: #166534;
            border: 1px solid rgba(187, 247, 208, 0.5);
        }

        .hidden {
            display: none;
        }

        .required {
            color: #dc2626;
        }

        .divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, #e2e8f0, transparent);
            margin: 32px 0;
        }

        @media (max-width: 480px) {
            .container {
                padding: 40px 32px;
            }

            h1 {
                font-size: 24px;
            }

            .logo {
                width: 80px;
                height: 80px;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <div class="logo">
            <img src="https://res.cloudinary.com/di4v3fcqi/image/upload/v1759842104/-99517281565_91685859341_1730702785_n_sws5nx.jpg" alt="Logo">
        </div>
        <h1>Complete Your Registration</h1>
        <p class="subtitle">Create your account to get started</p>
    </div>

    <div id="error-message" class="alert error hidden">
        <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
        </svg>
        <span id="error-text"></span>
    </div>

    <div id="success-message" class="alert success hidden">
        <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
        </svg>
        <span id="success-text"></span>
    </div>

    <form id="registrationForm">
        <input type="hidden" id="token" name="token" th:value="${token}">

        <div class="form-group">
            <label for="email">Email Address <span class="required">*</span></label>
            <div class="input-wrapper">
                <input type="email" id="email" name="email" placeholder="you@example.com" required>
            </div>
        </div>

        <div class="form-group">
            <label for="password">Password <span class="required">*</span></label>
            <div class="input-wrapper">
                <input type="password" id="password" name="password" placeholder="Enter password" required minlength="6">
                <button type="button" class="password-toggle" onclick="togglePassword('password')" aria-label="Toggle password visibility">
                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
                        <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/>
                    </svg>
                </button>
            </div>
            <div id="password-warning" class="password-warning hidden">
                <svg width="18" height="18" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                </svg>
                <span>Password must be at least 8 characters and include uppercase, lowercase, number, and special character (@$!%*?&).</span>
            </div>
        </div>

        <div class="form-group">
            <label for="confirmPassword">Confirm Password <span class="required">*</span></label>
            <div class="input-wrapper">
                <input type="password" id="confirmPassword" name="confirmPassword" placeholder="Confirm password" required>
                <button type="button" class="password-toggle" onclick="togglePassword('confirmPassword')" aria-label="Toggle password visibility">
                    <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
                        <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/>
                    </svg>
                </button>
            </div>
        </div>

        <button type="submit" class="btn" id="submitBtn" disabled>Complete Registration</button>
    </form>
</div>

<script>
    const strongPasswordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;

    function togglePassword(fieldId) {
        const field = document.getElementById(fieldId);
        field.type = field.type === 'password' ? 'text' : 'password';
    }

    function validatePasswordStrength() {
        const password = document.getElementById('password').value;
        const warning = document.getElementById('password-warning');
        const submitBtn = document.getElementById('submitBtn');

        if (password.length === 0) {
            warning.classList.add('hidden');
            submitBtn.disabled = true;
            return false;
        }

        const isStrong = strongPasswordRegex.test(password);

        if (isStrong) {
            warning.classList.add('hidden');
            submitBtn.disabled = false;
            return true;
        } else {
            warning.classList.remove('hidden');
            submitBtn.disabled = true;
            return false;
        }
    }

    document.getElementById('password').addEventListener('input', validatePasswordStrength);

    document.getElementById('registrationForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const errorDiv = document.getElementById('error-message');
        const errorText = document.getElementById('error-text');
        const successDiv = document.getElementById('success-message');
        const successText = document.getElementById('success-text');
        const submitBtn = document.getElementById('submitBtn');

        errorDiv.classList.add('hidden');
        successDiv.classList.add('hidden');

        const token = document.getElementById('token').value;
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirmPassword').value;

        if (!strongPasswordRegex.test(password)) {
            errorText.textContent = 'Password must be at least 8 characters long and contain at least one uppercase letter, one lowercase letter, one number, and one special character (@$!%*?&).';
            errorDiv.classList.remove('hidden');
            return;
        }

        if (password !== confirmPassword) {
            errorText.textContent = 'Passwords do not match!';
            errorDiv.classList.remove('hidden');
            return;
        }

        submitBtn.disabled = true;
        submitBtn.textContent = 'Processing...';

        try {
            const response = await fetch('/api/v1/guests/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    token: token,
                    email: email,
                    password: password
                })
            });

            if (response.ok) {
                successText.textContent = 'Registration completed successfully! Redirecting...';
                successDiv.classList.remove('hidden');

                setTimeout(() => {
                    window.location.href = '/registration-success';
                }, 2000);
            } else {
                const errorData = await response.json();
                errorText.textContent = errorData.message || 'Registration failed. Please try again.';
                errorDiv.classList.remove('hidden');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Complete Registration';
            }
        } catch (error) {
            errorText.textContent = 'An error occurred. Please check your connection and try again.';
            errorDiv.classList.remove('hidden');
            submitBtn.disabled = false;
            submitBtn.textContent = 'Complete Registration';
        }
    });
</script>
</body>
</html>